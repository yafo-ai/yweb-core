根据E:\GPT\y-sso\yweb-core 项目里面的文档，帮我设计一个 权限基础类库，设计一个基础权限模块，该模块需要实现以下核心功能：


1. 动态鉴权机制：
   - 根据用户角色和权限配置自动验证API访问权限
   - 实现基于RBAC（基于角色和用户的访问控制）的权限验证，权限可以给用或者角色
   - 支持细粒度的权限控制（如读/写/执行等操作级别）

2. 用户认证集成：
   - 与现有用户系统集成获取用户身份信息
   - 支持多种认证方式（JWT、OAuth等）
   - 实现会话管理和token验证机制

3. 权限策略引擎：
   - 可配置的权限规则管理
   - 支持权限继承和组合
   - 提供权限冲突检测和解决机制

4. 审计和报告功能：
   - 生成权限使用报告
   - 记录异常访问尝试
   - 提供安全审计日志



权限基础类库设计规划
基于对 yweb-core 项目的深入分析,我将设计一个完整的权限基础类库模块。该模块将遵循项目现有的架构模式和编码规范。
规划文档输出
我将创建以下规划文档(保存在 E:\GPT\y-sso\yweb-core 目录):
permission_module_design.md - 权限模块总体设计文档
模块架构设计
核心功能规划
数据模型设计
API接口设计
与现有模块的集成方案
文档内容概要
该规划文档将包含:
1. 模块架构
遵循 yweb 现有的模块组织结构
权限模块目录结构设计
与 ORM、Auth、Log 等模块的集成
2. 核心功能设计
动态鉴权机制: RBAC权限验证、细粒度权限控制
用户认证集成: 与现有JWT认证集成、多认证方式支持
权限策略引擎: 权限规则管理、权限继承、冲突检测
审计和报告: 权限使用报告、异常访问记录、安全审计日志
3. 数据模型设计
用户模型
角色模型
权限模型
用户-角色关联
角色-权限关联
用户-权限关联(直接授权)
4. API设计
权限检查装饰器
FastAPI依赖注入集成
权限验证中间件
权限管理API
5. 集成方案
与现有 BaseModel 的集成
与 JWT 认证的集成
与事务管理器的集成
与日志系统的集成

其他要求：

# 基于FastAPI和Casbin的完整动态权限管理系统的框架
这是一个基础库，用来提供给其他系统调用

核心痛点
讨厌硬编码权限 - 不想在代码里写死权限规则

需要动态配置 - 所有角色、权限都能在运行时修改

支持复杂权限场景 - 特别是行级（数据级）权限


1. 完全动态的权限系统
✅ 不需要重启服务就能修改权限
✅ 角色可以随时创建、修改、删除
✅ 权限规则可以动态添加、移除
✅ 用户角色可以实时调整
✅ 权限可以分给角色或者用户

2. 多层级的权限控制
✅ API级权限：哪些API能访问
✅ 数据级权限：哪些数据行能操作  
✅ 字段级权限：哪些字段能查看/修改
✅ 操作级权限：增删改查分别控制

3. 智能的自动化功能
✅ 自动扫描API，生成权限配置建议
✅ 权限继承，减少重复配置
✅ 批量操作，提高效率
✅ 权限的自动缓存机制，防止频繁数据库查询


# 其他项目使用的话需要以下方面比较便捷

想要可视化操作 - 通过管理界面点点鼠标就能配置
1. 直观的管理
✅ 像电商网站一样操作：选择 → 勾选 → 授权
✅ 可视化API列表，一眼看到所有接口
✅ 拖拽式权限分配，简单直接
✅ 实时权限测试，立即看到效果

# 可以支持以下权限场景：

场景1：新员工入职
1. 创建用户：张三
2. 选择角色：普通员工
3. 系统自动赋予：基础权限 + 部门权限
4. 额外勾选：项目协作权限
5. 完成！立即生效

场景2：新功能上线
1. 开发完成新API：POST /api/ai/chat
2. 系统自动发现新API
3. 管理员进入管理界面
4. 勾选API → 选择角色 → 授权
5. 完成！用户立即可以使用

场景3：临时权限

1. 临时需要：李四查看财务报告
2. 找到用户：李四
3. 添加临时权限：财务数据查看
4. 设置有效期：7天
5. 到期自动回收

场景4：部门数据隔离
1. 销售部看不到技术部数据
2. 部门经理可以看到本部门所有数据
3. 总经理可以看到所有部门数据
4. 配置一次，自动应用

核心特性实现
1. 动态API权限：Casbin策略实时更新
2. 行级数据权限：SQL自动重写 + 内存缓存
3. 权限继承：角色层级树形结构
4. 批量操作：事务处理保证一致性

该模块是底层基础类库，并不提供具体权限的实现，主要用于基础类库提供给应用。首先先阅读现在项目的源码和文档 。